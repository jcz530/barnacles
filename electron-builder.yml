appId: app.barnacles.app
productName: Barnacles
copyright: Copyright Â© 2025 Joe Czubiak

# Build directories
directories:
  output: dist
  buildResources: build

# Don't rebuild native modules - already built for Electron
npmRebuild: false
buildDependenciesFromSource: false
nodeGypRebuild: false

# Only include essential files for production
files:
  - 'dist/**/*'
  - 'package.json'
  - 'node_modules/**/*'
  # Exclude test files and documentation
  - '!node_modules/**/test{,/**/*}'
  - '!node_modules/**/tests{,/**/*}'
  - '!node_modules/**/*.test.*'
  - '!node_modules/**/*.spec.*'
  - '!node_modules/**/README.*'
  - '!node_modules/**/CHANGELOG.*'
  - '!node_modules/**/.github{,/**/*}'
  - '!node_modules/**/*.md'
  # Exclude source maps and TypeScript files
  - '!node_modules/**/*.map'
  - '!node_modules/**/*.ts'
  - '!node_modules/**/tsconfig.json'

# Include/exclude node modules patterns
# Note: Unpack native modules and CLI dependencies
# With better-sqlite3, we have a much simpler dependency tree
asarUnpack:
  # Native modules and their full dependency trees
  - '**/node_modules/better-sqlite3/**'
  - '**/node_modules/node-pty/**'
  # CLI dependencies - unpack everything the CLI needs
  - '**/node_modules/@clack/**'
  - '**/node_modules/@paralleldrive/**'
  - '**/node_modules/@noble/**'
  - '**/node_modules/drizzle-orm/**'
  - '**/node_modules/picocolors/**'
  - '**/node_modules/sisteransi/**'
  - '**/node_modules/dayjs/**'
  - '**/node_modules/ignore/**'
  # Native module helpers and their dependencies
  - '**/node_modules/bindings/**'
  - '**/node_modules/file-uri-to-path/**'
  - '**/node_modules/prebuild-install/**'
  - '**/node_modules/detect-libc/**'
  - '**/node_modules/expand-template/**'
  - '**/node_modules/github-from-package/**'
  - '**/node_modules/minimist/**'
  - '**/node_modules/mkdirp-classic/**'
  - '**/node_modules/napi-build-utils/**'
  - '**/node_modules/node-abi/**'
  - '**/node_modules/pump/**'
  - '**/node_modules/rc/**'
  - '**/node_modules/simple-get/**'
  - '**/node_modules/nan/**'
  # CLI distribution
  - '**/dist/cli/**'

# Include migrations as extra resources
extraResources:
  - 'migrations/**/*'

# Icons
icon: assets/icons/app

# Auto updater
publish:
  provider: github
  owner: jcz530
  repo: barnacles
  releaseType: release

# macOS configuration
mac:
  icon: assets/icons/app.icns
  category: public.app-category.productivity
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  notarize: true
  target:
    - target: dmg
      arch:
        - arm64
    - target: zip
      arch:
        - arm64

afterSign: scripts/notarize.cjs

# DMG configuration with custom background
dmg:
  title: '${productName} ${version}'
  icon: assets/icons/app.icns
  background: assets/dmg-background.png
  # backgroundColor: 'F6E3EF'
  window:
    width: 540
    height: 380
  contents:
    - x: 140
      y: 200
      type: file
    - x: 400
      y: 200
      type: link
      path: /Applications

# Windows configuration
win:
  icon: assets/icons/app.ico
  target:
    - target: nsis
      arch:
        - x64
        - ia32

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: always

# Linux configuration
linux:
  icon: assets/icons/app.png
  category: Utility
  target:
    - target: AppImage
      arch:
        - x64
    - target: deb
      arch:
        - x64
    - target: rpm
      arch:
        - x64
